## 界面卡顿分析

#### 界面显示
1. CPU 计算好显示内容提交到 GPU。
2. GPU 渲染完成后将渲染结果放入帧缓冲区。
3. 视频控制器会按照 VSync 信号逐行读取帧缓冲区的数据，经过可能的数模转换传递给显示器显示。

#### 卡顿原因
在 VSync(垂直同步) 信号到来后，系统图形服务会通过 CADisplayLink 等机制通知 App，App 主线程开始在 CPU 中计算显示内容，比如视图的创建、布局计算、图片解码、文本绘制等。随后 CPU 会将计算好的内容提交到 GPU 去，由 GPU 进行变换、合成、渲染。随后 GPU 会把渲染结果提交到帧缓冲区去，等待下一次 VSync 信号到来时显示到屏幕上。==由于垂直同步的机制，如果在一个 VSync 时间内，CPU 或者 GPU 没有完成内容提交，则那一帧就会被丢弃，等待下一次机会再显示，而这时显示屏会保留之前的内容不变。这就是界面卡顿的原因。==

#### 图名绘制
* 屏幕上能看到的所有文本内容控件，包括 UIWebView，在底层都是通过 CoreText 排版、绘制为 Bitmap 显示的。
* 当用 UIImage 或 CGImageScoure 的那几个方法创建图片时,图片并不会立刻解码.图片设置到 UIImageView 或者 CALayer.contents 中去,并且 CALayer 被提交到 GPU 前, CGImage 中的数据才会得到解码.这一步是发生在主线程的.如果想要绕开这个机制,常见的做法是在后台线程先把图片会知道 CGBitmapContext 中,然后冲 Bitmap 直接创建图片.


